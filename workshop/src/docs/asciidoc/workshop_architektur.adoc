// configure DE settings for asciidoc
include::_config.adoc[]

:title-logo-image: image:logo.png[Logo][scaledwidth=100%,align=right]


= Software Architektur Antrag "Logging"
Christian Feuz; Frank Moritz; Jan Klominsky; Michael Krausse; Ye Zhao
v0.1, 2016-13-09

== Workshop Architekturantrag

//ToDo List:
//- Longlist Vor- und Nachteile
//- Weshalb werden diese Varianten gewählt?
//- Protokollieren bei HTTPS
//- Verfügbarkeit der einzelnen Lösungen
//- Wie wird sichergestellt das auf den Fileserver geschrieben wird?
//- Verbindungsprokolle zwischen den Schichten
//- Anforderungsmapping ->
//- Bei Longlist gleich Killerkriterien ausschliessen
//- Synchroner Aufruf

=== Problemstellung

==== In welchem Unternehmen, Projekt, System stellt sich das Problem?

Die untersuchte Aufgabe stellt sich bei der Mobiliar Versicherung.
Bei diesem Unternehmen müssen beim Umgang mit den Kundenschadendaten besondere Sorgfaltspflichten der Mitarbeiter eingehalten werden.

==== Worin besteht genau das zu lösende Problem (Scope)?

Es soll mithilfe der Protokollierung sichergestellt werden, dass die Mitarbeiter korrekt mit Kundendaten umgehen.
Änderungen sollen nachvollzogen werden können und Mitarbeiter sollen nicht ohne Auftrag in den Kundendaten suchen.

==== Wer sind die Interessenvertreter?

Die Interessenvertreter sind: Mitarbeiter, Datenschutzbeauftragter.


=== Randbedingungen

Die Sicherheitsstufe der Protokolldaten entspricht der Sicherheitsstufe der Fachdaten.
Die Protokolldaten dürfen von Fachdaten geographisch getrennt gespeichert werden.
Die Protokolldaten sollen nach spätestens 24 Stunden abrufbar sein.

==== Technische Randbedingungen (z.B. Applikationsplattform, Referenz-Architektur)

|===
| Randbedingung | Ausprägung

| Technologie
| JEE

| Applikationsserver
| JBoss

| Datenbank
| Oracle, PostgreSQL

| Standardkommunikationsprotokoll zwischen Applikationen
| SOAP, REST

| Enterprise Service Bus
| darf eingesetzt werden

| Daten aus dem Backend
| Dürfen in Fachapplikation nicht gecached werden, damit Protokollierung nicht umgangen wird.

|===

==== Organisatorische Randbedingungen

include::_architekturziele.adoc[]

==== Welche wichtigsten Architekturziele sollen mit der Lösung erreicht werden?



== Lösungsvarianten

.Lösungsraum
image::morphologischer_kasten.jpg["Lösungsraum"]

* Blau: Variante 1
* Rot: Variante 2
* Grün: Variante 3
* Schwarz: Variante 4

include::_abgreifen.adoc[]
include::_speichern.adoc[]
include::_abfragen.adoc[]
include::_loeschen.adoc[]


include::_variante1.adoc[]

include::_variante2.adoc[]

include::_variante3.adoc[]

include::_variante4.adoc[]

== Auswertung

=== Variantenbewertung

=== Gewichtete Bewertungskriterien, nach denen die Varianten beurteilt werden


.Bewertungstabelle
[cols="2,1,1,1,1,4"]
|===
| Bewertungs- kriterium | Gewich- tung | V1 | V2 | V3 | Beschreibung

| Performanz
| 5
| -
| -
| -
| Die Protokollierung soll einen möchlichst kleinen Performanzimpact auf die Fachapplikation haben.

| Verfügbarkeit Fachapplikation
| 5
| -
| -
| -
| Die Verfügbarkeit der Fachapplikation darf nur unwesentlich beeinflusst werden.

| Verfügbarkeit Protokollierung
| 5
| -
| -
| -
| Die Verfügbarkeit muss so hoch wie möglich sein

| Skalierbarkeit
| 4
| -
| -
| -
| Skaliert das Produkt mit wachsender Anzahl von Requests (3 Mio pro Tag, 500 Mio pro Jahr, Datenvolumen 1TB)

| Integrierbar in unsere IT-Landschaft
| 4
| -
| -
| -
| Kann das Produkt nahtlos in unsere bestehende Landschaft integriert werden

| Sicherheit
| 4
| -
| -
| -
| Zugriff nur für berechtigte Personen

| Batchprozesse
| 4
| -
| -
| -
| Automatiche Prozesse werden nicht protokolliert

| Betriebs- und Wartungskosten (pro Jahr)
| 3
| -
| -
| -
| Betriebs- und Lizenzkosten, Support

| Erweiterbarkeit Protokollierung
| 3
| -
| -
| -
| Zusätzliche Funktionalität der bestehenden Protokollierung

| Erweiterbarkeit Fachapplikation
| 3
| -
| -
| -
| Neue Fachapplikationen müssen auch protokolliert werden

| Realisierungskosten (einmalig)
| 2
| -
| -
| -
| Wie aufwendig ist die Lösung zu bauen, Kaufpreis bei einer externen Lösung


| Genug passende Mitarbeiter mit Know-How
| 2
| -
| -
| -
| Verfügen wir über genügend verfügbare und qualifizierte Mitarbeiter um die Variante selber zu implementieren

| Konfigurierung der Aufbewahrungs- frist
| 2
| -
| -
| -
| Die Aufbewahrungsfrist der Protokollierungsdaten muss konfigurierbar sein (z.B 1 Jahr)

| Gesamtbewertung
| 46
| -
| -
| -
|

|===
Gewichtung:1 nicht relevant, 2 unwichtig, 2 weniger wichtig, 3 wichtig, 4 ziemlich wichtig  5 sehr wichtig


*Begründung der Gewichtung*

* Performanz, Verfügbarkeit sind wichtige Architekturziele, darum werden sie mit 10 Punkten bewertet.
* Skalierbarkeit, Sicherheit, Batchprozesse und Integrierbarkeit werden mit 8 Punkten bewertet, weil sie intergrale Bestandteile der Nicht-Funktionalen Anforderungen sind.
* Betriebs- und Wartungskosten, die Erfüllung der fachlichen Anforderungen sind wichtiger als die Kosten, daher werden die Kosten nur mit 4 bzw. mit 6 Punkten bewertet.
Da die Lebensdauer der Applikation mehrere Jahre dauert, werden die die laufenden Kosten höher bewertet.
* Die Software wird nicht ständig erweitert, somit wird die Erweiterbarkeit mit 5 Punkten bewertet.
* Das Know-How der Mitarbeiter bewerten wir mit 5 Punkten, weil wir nach Bedarf kurzfristig externe Ressourcen  einkaufen  oder mittelfristig die Mitarbeiter  ausbilden können.
* Die Konfigurierung der Aufbewahrungsfrist wird nicht häufig vorgenommen, somit bewerten wir sie mit 3 Punkten.



=== Begründete Bewertung der verschiedenen Varianten in einer Bewertungsmatrix

*Variante 1*

|===
| Bewertungskriterium | Begründung | Punkte

| Performanz
| -
| -

| Verfügbarkeit Fachapplikation
| -
| -


| Verfügbarkeit Protokollierung
| -
| -


| Skalierbarkeit
| -
| -


| Genug passende Mitarbeiter mit Know-How
| -
| -


| Realisierungskosten (einmalig)
| -
| -

| Betriebs- und Wartungskosten (pro Jahr)
| -
| -

| Erweiterbarkeit Protokollierung
| -
| -

| Erweiterbarkeit Fachapplikation
| -
| -


| Integrierbar in unsere IT-Landschaft
| -
| -

| Sicherheit
| -
| -

| Batchprozesse
| -
| -


| Konfigurierung der Aufbewahrungsfrist
| -
| -


| Gesamtbewertung
| -
| -

|===


include::_begruendungV4.adoc[]


== Antrag

=== Begründeter Antrag zur Umsetzung einer Variante

=== Kosten- und Aufwandschätzung (Infrastruktur, Ressourcen)

=== Mögliche Risiken und Massnahmen (Minderung, Behandlung, Akzeptieren)


== Glossar

* ELK-Stack : Elasticsearch, Logstash, and Kibana, Tool zum Auswerten von Logdateien. https://www.elastic.co/webinars/introduction-elk-stack
* JSR-352 : Standard für die Erstellung von Batches im Java Ökosystemen. https://jcp.org/en/jsr/detail?id=352
* Splunk : Kommerzielles Tool für Auswertung von Logdateien. https://www.splunk.com/

// Notizen nur zur Information, aber keine ANforderung sie zu liefern
//
//== Sonstige Dokumentation
//
//* Konsistenz: dürfen wir selbst definieren, wie konsistent die Daten sein müssen
//* 10 Mal mehr Lesen, als Speichern
//
//* Ansätze
//** CQRS
//** Aspect Orientierted Einbau
//
//* Teilprobleme
//** Fragen
//*** Wo/ wie?, Abhängigkeiten
//** Abreifen
//** Speichern
//** Abfragen
//** Löschen
//
//* Topdown approach (vom abstrakten zum konkreten)

// Bei Shortlist auf Anforderungen bezug nehmen, welche Anforderungen werden nicht erfüllt



= Anhang

== Implementierungsdetails Variante 4


===== Abgreifen

Neue Bibliothek erstellen, die eine Methode zur Protokollierung bereitstellt.
Die Methode hat als Übergabeparameter das SecurityToken, den Methodenname, die Fachapplikation usw.
Die Protokollierungsdaten werden zunächst in eine lokale Textdatei gespeichert.
Pro Tag wird eine Datei erstellt.

Die Methode prüft anhand des SecurityTokens, ob eine Protokollierung notwendig ist.
Falls ja, wird eine ID und der Status (OK, NOK, IGNORE)zurück gegeben.
Nur wenn als Status OK oder IGNORE zurückgeliefert wurde, wird die Fachapplikation die Daten abfragen bzw. mutieren.
Anschliessend wird eine weitere Methode der Bibliothek mit den Übergabeparametern ID und Abfrageergebnis aufgerufen, (wenn der Status OK ist).
Diese Daten werden ebenfalls in der Textdatei gespeichert.

*Vorteil*

hohe Performance, da zunächst nur in eine lokale Textdatei geschrieben wird.

Die Protokollierungen der einzelnen Fachapplikationen erfolgt unabhängig voneinander und können sich dadurch nicht gegenseitig behindern.

Es stehen sämtliche erforderlichen Protokollierungsdaten zur Verfügung.

*Nachteil*

Jede Fachapplikation muss angepasst werden und es muss sichergestellt werden, dass auch jede Fachapplikation den Aufruf durchführt.


===== Speichern

Es wird eine neue Applikation implementiert, die täglich die Daten der einzelnen Textdateien in einer zentralen Datenbank speichert.
Gleichzeitig wird das Abfrageergebnis beim ursprünglichen Eintrag ergänzt, damit es pro ID nur einen Datensatz gibt.
Wenn die Daten überführt wurden, wird die Textdatei gelöscht.
Dadurch wird sichergestellt, dass die Daten nur einmal eingelesen werden.
Wenn aus irgendeinen Grund die Daten nicht gespeichert werden konnten, können so aber auch Textdateien zu einem späteren Zeitpunkt eingelesen werden.

*Vorteile*

Die Daten stehen letztendlich an einer zentralen Stelle zur Verfügung, was die spätere Auswertung enorm erleichtert.

*Nachteile*

Zusätzliche Applikation notwendig.

Die Daten stehen erst mit einiger Verzögerung zur Auswertung zur Verfügung.

Es muss sichergestellt werden, dass alle Fachapplikationen berücksichtigt werden.

===== Abfragen

*Untervariante1 - Direkte Abfrage über die Datenbank*

Der Datenschutzbeauftragte erhält direkten Lesezugriff auf die Datenbank.

*Vorteile*

Es können beliebige Auswertungen vorgenommen werden.

Es muss nichts zusätzlich implementiert werden.


*Nachteil*

Der Datenschutzbeauftragte muss die erforderlichen SQL-Kenntnisse besitzen.

*Untervariante2 - Eigene Auswertungsapplikation*

Es wird eine neue Applikation für die Auswertung der Protokollierungsdaten implementiert

*Vorteile*

Der Datenschutzbeauftragte muss keine SQL-Kenntnisse besitzen.

Zusätzlich wäre es aber trotzdem möglich, die Eingabe von SQL-Statements zu erlauben, um die Vorteile der Variante 1 zu haben.

*Nachteile*

Zusätzlicher Implementierungsaufwand.


===== Löschen

Die Daten liegen zentral in einer Datenbank.
Es wird ein Datenbank-Job eingerichtet, der jede Nacht die Daten löscht, die älter als ein 1 Jahr sind.

*Vorteile*

Einfach einzurichten

Performant

*Nachteile*

Wenn sich der Zeitraum ändert, muss der Datenbank-Job angepasst werden.
